<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Space Invaders</title>
        <link rel="stylesheet" href="style_walker.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>

    <body>
        <!-- <div id="demo" class="animator">
            <p id="image" onmouseover="animateScript2()"> </p>
        </div> -->
        <div id="editor" class="editor row animator">
            <div class="column">
                    <label for="tag-name">Clip Name</label><br>
                    <input id="tag-name" type="text" name="tag-name" value="">

                <p> image-background position</p>
                <p>
                    <label for="pos-x">X</label>
                    <input class="xy-box" id="pos-x" type="number" name="pos-x" value="0">

                    <label for="pos-y">Y</label>
                    <input class="xy-box" id="pos-y" type="number" name="pos-y" value="0">
                </p>
                <hr>
                <p>Move Direction</p>
                <p>
                    <label for="horzStep">Horz. Step</label>
                    <input id="horzStep" type="number" name="horzStep" class="xy-box" value="50">
                    <label for="vertStep">Vert. Step</label>
                    <input id="vertStep" type="number" name="vertStep" class="xy-box" value="1">
                </p>
                <hr>
                <p>
                    Frame Data
                    <label for="frame"> #</label>
                    <input id="frame" type="number" name="frame" class="xy-box" value="1">
                </p>
                <pre id="json-frame" contenteditable="true"></pre>
                <button type="button" name="add-btn" onclick="addFrame()">Add</button>
            </div>
            <div class="column animator">
                <p style="margin-left: 20px;">position <span id="edtrPos">0,0</span></p>
                <p id="imgEdtr"></p>
            </div>
            <div class="column">
                <p>Clip Data</p>
                <pre id="json-clip" contenteditable="true"></pre>
            <div class="row">
                <button type="button" name="run-btn" onclick="runClip()">Run</button>
                <button type="button" name="save-btn" onclick="saveClip()">Save</button>
                <button type="button" name="load-btn" onclick="loadClip()">Load</button>
            </div>
            </div>
        </div>
        <div class="animator preview-clip">
            <p id="imgAm"></p>
        </div>

    </body>
    <script type="text/javascript">

        var  tID; // variable to clear the setInterval()
        var start = true;
        function animateScript() {
            var    position = 256; //start position image slicer
            const  interval = 300; //600 ms of interval
            var    frame = 0, offset = 0;
            var    demo = document.getElementById("demo");
            var    img = document.getElementById("image");
            if (start){
                start = false;
                tID = setInterval ( () => {
                    img.style.backgroundPosition =`-${position}px 0px`;
                    img.style.left = `${offset}px`;
                    ++ frame
                    document.getElementById("pos").innerHTML = position+ " frame "+ frame + " offset "+ offset +" "+ demo.width;
                    if(offset > demo.width) offset = -10;
                    if (position < 1536) {
                        position = position + 230;
                        offset += 10;
                        if(offset  > 1600)offset = 0;
                    } //we increment the position by 230 each time
                    else {
                        position = 265; //reset to 265px, once position exceeds 1536px
                        frame = 0
                        offset += 20;
                    }
                }
                , interval );
            }
        }
        var editor  = document.getElementById("imgEdtr");
        var jsonPre = document.getElementById("json-frame");
        var imgAm   = document.getElementById("imgAm");
        var lft = 0, tp = 0, horzPos, vertPos, frameJson, clipJson = [];
        var max = 1;
        var poslft = 0, postop;

        document.onkeydown = function(e) {
            var xbox     = parseInt(document.getElementById("pos-x").value);
            var ybox     = parseInt(document.getElementById("pos-y").value);
            var horzStep = parseInt(document.getElementById("horzStep").value);
            var vertStep = parseInt(document.getElementById("vertStep").value);
            var frame    = parseInt(document.getElementById("frame").value);
            horzPos = xbox > 0 ? xbox :234;
            vertPos = ybox > 0 ? ybox :234;
            console.log(e.keyCode);
            switch (e.keyCode) {
                case 37:
                    lft -= horzPos;
                    poslft -= horzStep;
                    break;
                case 39:
                    lft += horzPos;
                    poslft += horzStep;
                    break;
                case 38:
                    tp -= vertPos ;
                    break;
                case 40:
                    tp += vertPos;
                    break;
                default:
            }
            max = Math.max(frame,max)
            if(lft > 1638) lft = 0; frame = 0;
            if(lft < 0 ) lft = 1638; frame = max
            var json = {
                tag:   document.getElementById("tag-name").value,
                top:   tp,
                left:  lft,
                frame: frame,
                horzStep:  horzStep,
                vertStep:  vertStep,
            }
            editor.style.backgroundPosition =`${lft}px ${tp}px`;
            imgAm.style.backgroundPosition =`${lft}px ${tp}px`;
            imgAm.style.left = `${poslft}px`;
            document.getElementById("edtrPos").innerHTML =`${lft}px ${tp}px`
            document.getElementById("json-frame").innerHTML = JSON.stringify(json,null,4);
        }

    </script>
</html>
